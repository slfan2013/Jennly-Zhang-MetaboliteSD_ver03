if(continuous){
}else{
print(Raw_Phenotype_UCDavis_e_merge[i,])
}
}
lm(Raw_Phenotype_UCDavis_e_merge[i,], Raw_Phenotype_UCDavis_p_null$Gender)
lm(Raw_Phenotype_UCDavis_e_merge[i,]~ Raw_Phenotype_UCDavis_p_null$Gender)
i = 1
Raw_Phenotype_UCDavis_p_null$Gender
lm(Raw_Phenotype_UCDavis_e_merge[i,]~ Raw_Phenotype_UCDavis_p_null$Gender)
Raw_Phenotype_UCDavis_e_merge
dim(Raw_Phenotype_UCDavis_e_merge)
Raw_Phenotype_UCDavis_e_merge[1,]
lm(as.numeric(Raw_Phenotype_UCDavis_e_merge[i,])~ Raw_Phenotype_UCDavis_p_null$Gender)
length(as.numeric(Raw_Phenotype_UCDavis_e_merge[i,]))
Null_Metabolomics = wcmc::read_data("Null_Metabolomics.xlsx")
Null_Metabolomics_p = Null_Metabolomics$p
Null_Metabolomics_f = Null_Metabolomics$f
Null_Metabolomics_e = Null_Metabolomics$e_matrix
## 1 wild - sex
### deal with missing value.
#### filter missing value > 80%
num_missing_male = apply(Null_Metabolomics_e,1,function(x){
sum(is.na(x[Null_Metabolomics_p$Gender %in% "Male"]))
})
num_missing_female = apply(Null_Metabolomics_e,1,function(x){
sum(is.na(x[Null_Metabolomics_p$Gender %in% "Female"]))
})
names(num_missing_male) = names(num_missing_female) = Null_Metabolomics_f$label
missing_index = ((num_missing_male/sum(Null_Metabolomics_p$Gender %in% "Male")) > 0.8)|((num_missing_female/sum(Null_Metabolomics_p$Gender %in% "Female")) > 0.8)
Null_Metabolomics_e = Null_Metabolomics_e[!missing_index,]
Null_Metabolomics_f = Null_Metabolomics_f[!missing_index,]
#### filter missing value > 80%
for(i in 1:nrow(Null_Metabolomics_e)){
Null_Metabolomics_e[i,is.na(Null_Metabolomics_e[i,])] = 0.5 * min(Null_Metabolomics_e[i,], na.rm = TRUE)
}
rownames(Null_Metabolomics_e) = Null_Metabolomics_f$label
## statistics
p_val1 = apply(Null_Metabolomics_e,1,function(x){
summary(lm(x ~ Null_Metabolomics_p$Gender))$coefficients[2,4]
})
fc1 = apply(Null_Metabolomics_e,1,function(x){
mean(x[Null_Metabolomics_p$Gender %in% "Male"])/mean(x[Null_Metabolomics_p$Gender %in% "Female"])
})
p_val_adj1 = p.adjust(p_val1, method = "fdr")
## 2 adjust by body weight
Phenotype_UCDavisSelect = wcmc::read_data("Phenotype_UCDavisSelect.xlsx")
Phenotype_UCDavisSelect_p = Phenotype_UCDavisSelect$p
Phenotype_UCDavisSelect_f = Phenotype_UCDavisSelect$f
Phenotype_UCDavisSelect_e = Phenotype_UCDavisSelect$e_matrix
body_weight_all = Phenotype_UCDavisSelect_e[,Phenotype_UCDavisSelect_p[["phenotype"]] %in% "Body weight"]
names(body_weight_all) = Phenotype_UCDavisSelect_f$label
body_weight = body_weight_all[Null_Metabolomics_p$label]
p_val2 = apply(Null_Metabolomics_e,1,function(x){
summary(lm(x ~ Null_Metabolomics_p$Gender + body_weight))$coefficients[2,4]
})
fc2 = apply(Null_Metabolomics_e,1,function(x){
summary(lm(x ~ Null_Metabolomics_p$Gender + body_weight))$coefficients[2,1]
})
p_val_adj2 = p.adjust(p_val2,"fdr")
## 3 phenotype
Raw_Phenotype_UCDavis = wcmc::read_data("Raw_Phenotype_UCDavis.xlsx")
Raw_Phenotype_UCDavis_p = Raw_Phenotype_UCDavis$p
Raw_Phenotype_UCDavis_f = Raw_Phenotype_UCDavis$f
Raw_Phenotype_UCDavis_e = Raw_Phenotype_UCDavis$e_cat_matrix
Raw_Phenotype_UCDavis_f$label_procedure = sapply(strsplit(Raw_Phenotype_UCDavis_f$label,"___"),function(x){x[1]})
Raw_Phenotype_UCDavis_f$label_phenotype = sapply(strsplit(Raw_Phenotype_UCDavis_f$label,"___"),function(x){x[2]})
rownames(Raw_Phenotype_UCDavis_e) = Raw_Phenotype_UCDavis_f$label
# combine the phenotypes because one phenotype may have multiple procedures.
unique_phenotype = unique(Raw_Phenotype_UCDavis_f$label_phenotype)
for(u in 1:length(unique_phenotype)){
if(sum(Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u])>1){
if(length(table(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],]))>1){
duplicated_value_index = which(apply(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],],2,function(x){
if(length(unique(x)) == 1){
if(!unique(x)=="NA"){
return(TRUE)
}else{
return(FALSE)
}
}else{
return(FALSE)
}
}))
if(length(duplicated_value_index)>0){
print(unique_phenotype[u])
print(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],1:10])
Sys.sleep(20)
}
}
}
}
Raw_Phenotype_UCDavis_e_merge = matrix(NA, nrow = length(unique(Raw_Phenotype_UCDavis_f$label_phenotype)), ncol = ncol(Raw_Phenotype_UCDavis_e))
rownames(Raw_Phenotype_UCDavis_e_merge) = unique(Raw_Phenotype_UCDavis_f$label_phenotype)
i = 1
for(u in 1:length(unique_phenotype)){
if(sum(Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u])>1){
# stop(u)
for(j in 1:ncol(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],])){
the_j_th_col = Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],j]
if(!length(unique(the_j_th_col)) == 1){
Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],][the_j_th_col == "NA",j] = Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],][!the_j_th_col == "NA",j]
}
}
Raw_Phenotype_UCDavis_e_merge[i,] = unique(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],])
i = i + 1
}else{
Raw_Phenotype_UCDavis_e_merge[i,] = Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],]
i = i + 1
}
}
#   if(sum(is.na(as.numeric(Raw_Phenotype_UCDavis_e_merge[i,]))) > nrow(Raw_Phenotype_UCDavis_p)/2){
#     print(i)
#     print(table(Raw_Phenotype_UCDavis_e_merge[i,]))
#     cat("\n")
#     Sys.sleep(2)
#   }
#
# }
#
#
Raw_Phenotype_UCDavis_e_merge[Raw_Phenotype_UCDavis_e_merge == "NA"] = NA
Raw_Phenotype_UCDavis_e_null = Raw_Phenotype_UCDavis_e_merge[,Raw_Phenotype_UCDavis_p$Genotype %in% "(null)"]
Raw_Phenotype_UCDavis_p_null = Raw_Phenotype_UCDavis_p[Raw_Phenotype_UCDavis_p$Genotype %in% "(null)",]
i = 1
p_val3 = c()
continuous = sum(is.na(as.numeric(Raw_Phenotype_UCDavis_e_merge[i,!is.na(Raw_Phenotype_UCDavis_e_merge[i,])]))) == 0
continuous
lm(as.numeric(Raw_Phenotype_UCDavis_e_merge[i,])~ Raw_Phenotype_UCDavis_p_null$Gender)
as.numeric(Raw_Phenotype_UCDavis_e_merge[i,])
length(as.numeric(Raw_Phenotype_UCDavis_e_merge[i,]))
lm(as.numeric(Raw_Phenotype_UCDavis_e_null[i,])~ Raw_Phenotype_UCDavis_p_null$Gender)
summary(lm(as.numeric(Raw_Phenotype_UCDavis_e_null[i,])~ Raw_Phenotype_UCDavis_p_null$Gender))$coef
?xtabs
xtabs(cbind(ncases, ncontrols) ~ ., data = esoph)
xtabs(cbind(ncases) ~ ., data = esoph)
ftable(xtabs(cbind(ncases, ncontrols) ~ ., data = esoph))
ftable(xtabs(cbind(ncases, ncontrols) ~ agegp, data = esoph))
summary(xtabs(cbind(ncases, ncontrols) ~ agegp, data = esoph))
summary(xtabs(ncases ~ agegp, data = esoph))
summary(xtabs(agegp + ncases, data = esoph))
summary(xtabs(ncontrols + ncases, data = esoph))
colnames(esoph)
summary(xtabs(~ncontrols + ncases, data = esoph))
summary(xtabs(~Raw_Phenotype_UCDavis_e_null[i,] + Raw_Phenotype_UCDavis_p_null$Gender))
o = summary(xtabs(~Raw_Phenotype_UCDavis_e_null[i,] + Raw_Phenotype_UCDavis_p_null$Gender))
names(o)
o$p.value
#
# for(i in 1:nrow(Raw_Phenotype_UCDavis_e_merge)){
#
#   if(sum(is.na(as.numeric(Raw_Phenotype_UCDavis_e_merge[i,]))) > nrow(Raw_Phenotype_UCDavis_p)/2){
#     print(i)
#     print(table(Raw_Phenotype_UCDavis_e_merge[i,]))
#     cat("\n")
#     Sys.sleep(2)
#   }
#
# }
#
#
Raw_Phenotype_UCDavis_e_merge[Raw_Phenotype_UCDavis_e_merge == "NA"] = NA
Raw_Phenotype_UCDavis_e_null = Raw_Phenotype_UCDavis_e_merge[,Raw_Phenotype_UCDavis_p$Genotype %in% "(null)"]
Raw_Phenotype_UCDavis_p_null = Raw_Phenotype_UCDavis_p[Raw_Phenotype_UCDavis_p$Genotype %in% "(null)",]
p_val3 = c()
for(i in 1:nrow(Raw_Phenotype_UCDavis_e_merge)){
continuous = sum(is.na(as.numeric(Raw_Phenotype_UCDavis_e_merge[i,!is.na(Raw_Phenotype_UCDavis_e_merge[i,])]))) == 0
if(continuous){
p_val3[length(p_val3)+1] = summary(lm(as.numeric(Raw_Phenotype_UCDavis_e_null[i,])~ Raw_Phenotype_UCDavis_p_null$Gender))$coef[2,4]
}else{
p_val3[length(p_val3)+1] = summary(xtabs(~Raw_Phenotype_UCDavis_e_null[i,] + Raw_Phenotype_UCDavis_p_null$Gender))$p.value
}
}
i
continuous
as.numeric(Raw_Phenotype_UCDavis_e_null[i,])
#
# for(i in 1:nrow(Raw_Phenotype_UCDavis_e_merge)){
#
#   if(sum(is.na(as.numeric(Raw_Phenotype_UCDavis_e_merge[i,]))) > nrow(Raw_Phenotype_UCDavis_p)/2){
#     print(i)
#     print(table(Raw_Phenotype_UCDavis_e_merge[i,]))
#     cat("\n")
#     Sys.sleep(2)
#   }
#
# }
#
#
Raw_Phenotype_UCDavis_e_merge[Raw_Phenotype_UCDavis_e_merge == "NA"] = NA
Raw_Phenotype_UCDavis_e_null = Raw_Phenotype_UCDavis_e_merge[,Raw_Phenotype_UCDavis_p$Genotype %in% "(null)"]
Raw_Phenotype_UCDavis_p_null = Raw_Phenotype_UCDavis_p[Raw_Phenotype_UCDavis_p$Genotype %in% "(null)",]
p_val3 = c()
for(i in 1:nrow(Raw_Phenotype_UCDavis_e_merge)){
continuous = sum(is.na(as.numeric(Raw_Phenotype_UCDavis_e_merge[i,!is.na(Raw_Phenotype_UCDavis_e_merge[i,])]))) == 0
if(continuous){
p_val3[length(p_val3)+1] = tryCatch(summary(lm(as.numeric(Raw_Phenotype_UCDavis_e_null[i,])~ Raw_Phenotype_UCDavis_p_null$Gender))$coef[2,4],error = function(er){
return(NA)
})
}else{
p_val3[length(p_val3)+1] = summary(xtabs(~Raw_Phenotype_UCDavis_e_null[i,] + Raw_Phenotype_UCDavis_p_null$Gender))$p.value
}
}
p_val3
sum(p_val3<0.05)
sum(p_val3<0.05, na.rm = TRUE)
continuous_index = c()
Raw_Phenotype_UCDavis_e_merge[Raw_Phenotype_UCDavis_e_merge == "NA"] = NA
Raw_Phenotype_UCDavis_e_null = Raw_Phenotype_UCDavis_e_merge[,Raw_Phenotype_UCDavis_p$Genotype %in% "(null)"]
Raw_Phenotype_UCDavis_p_null = Raw_Phenotype_UCDavis_p[Raw_Phenotype_UCDavis_p$Genotype %in% "(null)",]
p_val3 = c()
continuous_index = c()
for(i in 1:nrow(Raw_Phenotype_UCDavis_e_merge)){
continuous = sum(is.na(as.numeric(Raw_Phenotype_UCDavis_e_merge[i,!is.na(Raw_Phenotype_UCDavis_e_merge[i,])]))) == 0
if(continuous){
continuous_index[i] = TRUE
p_val3[length(p_val3)+1] = tryCatch(summary(lm(as.numeric(Raw_Phenotype_UCDavis_e_null[i,])~ Raw_Phenotype_UCDavis_p_null$Gender))$coef[2,4],error = function(er){
return(NA)
})
}else{
continuous_index[i] = FALSE
p_val3[length(p_val3)+1] = summary(xtabs(~Raw_Phenotype_UCDavis_e_null[i,] + Raw_Phenotype_UCDavis_p_null$Gender))$p.value
}
}
continuous_index
p_val3[continuous_index]
sum(p_val3[continuous_index]<0.05,na.rm = TRUE)
sum(p_val3[continuous_index]<0.05,na.rm = TRUE)/sum(continuous_index)
"IMPC_DXA_002_001"
rownames(Raw_Phenotype_UCDavis_e_merge) %in% Raw_Phenotype_UCDavis_e_merge
which(rownames(Raw_Phenotype_UCDavis_e_merge) %in% Raw_Phenotype_UCDavis_e_merge)
rownames(Raw_Phenotype_UCDavis_e_merge)
sort(rownames(Raw_Phenotype_UCDavis_e_merge) )
Null_Metabolomics = wcmc::read_data("Null_Metabolomics.xlsx")
Null_Metabolomics_p = Null_Metabolomics$p
Null_Metabolomics_f = Null_Metabolomics$f
Null_Metabolomics_e = Null_Metabolomics$e_matrix
## 1 wild - sex
### deal with missing value.
#### filter missing value > 80%
num_missing_male = apply(Null_Metabolomics_e,1,function(x){
sum(is.na(x[Null_Metabolomics_p$Gender %in% "Male"]))
})
num_missing_female = apply(Null_Metabolomics_e,1,function(x){
sum(is.na(x[Null_Metabolomics_p$Gender %in% "Female"]))
})
names(num_missing_male) = names(num_missing_female) = Null_Metabolomics_f$label
missing_index = ((num_missing_male/sum(Null_Metabolomics_p$Gender %in% "Male")) > 0.8)|((num_missing_female/sum(Null_Metabolomics_p$Gender %in% "Female")) > 0.8)
Null_Metabolomics_e = Null_Metabolomics_e[!missing_index,]
Null_Metabolomics_f = Null_Metabolomics_f[!missing_index,]
#### filter missing value > 80%
for(i in 1:nrow(Null_Metabolomics_e)){
Null_Metabolomics_e[i,is.na(Null_Metabolomics_e[i,])] = 0.5 * min(Null_Metabolomics_e[i,], na.rm = TRUE)
}
rownames(Null_Metabolomics_e) = Null_Metabolomics_f$label
## statistics
p_val1 = apply(Null_Metabolomics_e,1,function(x){
summary(lm(x ~ Null_Metabolomics_p$Gender))$coefficients[2,4]
})
fc1 = apply(Null_Metabolomics_e,1,function(x){
mean(x[Null_Metabolomics_p$Gender %in% "Male"])/mean(x[Null_Metabolomics_p$Gender %in% "Female"])
})
p_val_adj1 = p.adjust(p_val1, method = "fdr")
## 2 adjust by body weight
Phenotype_UCDavisSelect = wcmc::read_data("Phenotype_UCDavisSelect.xlsx")
Phenotype_UCDavisSelect_p = Phenotype_UCDavisSelect$p
Phenotype_UCDavisSelect_f = Phenotype_UCDavisSelect$f
Phenotype_UCDavisSelect_e = Phenotype_UCDavisSelect$e_matrix
body_weight_all = Phenotype_UCDavisSelect_e[,Phenotype_UCDavisSelect_p[["phenotype"]] %in% "Body weight"]
names(body_weight_all) = Phenotype_UCDavisSelect_f$label
body_weight = body_weight_all[Null_Metabolomics_p$label]
p_val2 = apply(Null_Metabolomics_e,1,function(x){
summary(lm(x ~ Null_Metabolomics_p$Gender + body_weight))$coefficients[2,4]
})
fc2 = apply(Null_Metabolomics_e,1,function(x){
summary(lm(x ~ Null_Metabolomics_p$Gender + body_weight))$coefficients[2,1]
})
p_val_adj2 = p.adjust(p_val2,"fdr")
## 3 phenotype
Raw_Phenotype_UCDavis = wcmc::read_data("Raw_Phenotype_UCDavis.xlsx")
Raw_Phenotype_UCDavis_p = Raw_Phenotype_UCDavis$p
Raw_Phenotype_UCDavis_f = Raw_Phenotype_UCDavis$f
Raw_Phenotype_UCDavis_e = Raw_Phenotype_UCDavis$e_cat_matrix
Raw_Phenotype_UCDavis_f$label_procedure = sapply(strsplit(Raw_Phenotype_UCDavis_f$label,"___"),function(x){x[1]})
Raw_Phenotype_UCDavis_f$label_phenotype = sapply(strsplit(Raw_Phenotype_UCDavis_f$label,"___"),function(x){x[2]})
rownames(Raw_Phenotype_UCDavis_e) = Raw_Phenotype_UCDavis_f$label
# combine the phenotypes because one phenotype may have multiple procedures.
unique_phenotype = unique(Raw_Phenotype_UCDavis_f$label_phenotype)
for(u in 1:length(unique_phenotype)){
if(sum(Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u])>1){
if(length(table(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],]))>1){
duplicated_value_index = which(apply(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],],2,function(x){
if(length(unique(x)) == 1){
if(!unique(x)=="NA"){
return(TRUE)
}else{
return(FALSE)
}
}else{
return(FALSE)
}
}))
if(length(duplicated_value_index)>0){
print(unique_phenotype[u])
print(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],1:10])
Sys.sleep(20)
}
}
}
}
Raw_Phenotype_UCDavis_e_merge = matrix(NA, nrow = length(unique(Raw_Phenotype_UCDavis_f$label_phenotype)), ncol = ncol(Raw_Phenotype_UCDavis_e))
rownames(Raw_Phenotype_UCDavis_e_merge) = unique(Raw_Phenotype_UCDavis_f$label_phenotype)
i = 1
for(u in 1:length(unique_phenotype)){
if(sum(Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u])>1){
# stop(u)
for(j in 1:ncol(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],])){
the_j_th_col = Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],j]
if(!length(unique(the_j_th_col)) == 1){
Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],][the_j_th_col == "NA",j] = Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],][!the_j_th_col == "NA",j]
}
}
Raw_Phenotype_UCDavis_e_merge[i,] = unique(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],])
i = i + 1
}else{
Raw_Phenotype_UCDavis_e_merge[i,] = Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],]
i = i + 1
}
}
#
# for(i in 1:nrow(Raw_Phenotype_UCDavis_e_merge)){
#
#   if(sum(is.na(as.numeric(Raw_Phenotype_UCDavis_e_merge[i,]))) > nrow(Raw_Phenotype_UCDavis_p)/2){
#     print(i)
#     print(table(Raw_Phenotype_UCDavis_e_merge[i,]))
#     cat("\n")
#     Sys.sleep(2)
#   }
#
# }
#
#
Raw_Phenotype_UCDavis_e_merge[Raw_Phenotype_UCDavis_e_merge == "NA"] = NA
Raw_Phenotype_UCDavis_e_null = Raw_Phenotype_UCDavis_e_merge[,Raw_Phenotype_UCDavis_p$Genotype %in% "(null)"]
Raw_Phenotype_UCDavis_p_null = Raw_Phenotype_UCDavis_p[Raw_Phenotype_UCDavis_p$Genotype %in% "(null)",]
p_val3 = c()
continuous_index = c()
sort(rownames(Raw_Phenotype_UCDavis_e_merge) )
which(rownames(Raw_Phenotype_UCDavis_e_merge) %in% "IMPC_DXA_002_001")
p_val3[23]
Null_Metabolomics = wcmc::read_data("Null_Metabolomics.xlsx")
Null_Metabolomics_p = Null_Metabolomics$p
Null_Metabolomics_f = Null_Metabolomics$f
Null_Metabolomics_e = Null_Metabolomics$e_matrix
## 1 wild - sex
### deal with missing value.
#### filter missing value > 80%
num_missing_male = apply(Null_Metabolomics_e,1,function(x){
sum(is.na(x[Null_Metabolomics_p$Gender %in% "Male"]))
})
num_missing_female = apply(Null_Metabolomics_e,1,function(x){
sum(is.na(x[Null_Metabolomics_p$Gender %in% "Female"]))
})
names(num_missing_male) = names(num_missing_female) = Null_Metabolomics_f$label
missing_index = ((num_missing_male/sum(Null_Metabolomics_p$Gender %in% "Male")) > 0.8)|((num_missing_female/sum(Null_Metabolomics_p$Gender %in% "Female")) > 0.8)
Null_Metabolomics_e = Null_Metabolomics_e[!missing_index,]
Null_Metabolomics_f = Null_Metabolomics_f[!missing_index,]
#### filter missing value > 80%
for(i in 1:nrow(Null_Metabolomics_e)){
Null_Metabolomics_e[i,is.na(Null_Metabolomics_e[i,])] = 0.5 * min(Null_Metabolomics_e[i,], na.rm = TRUE)
}
rownames(Null_Metabolomics_e) = Null_Metabolomics_f$label
## statistics
p_val1 = apply(Null_Metabolomics_e,1,function(x){
summary(lm(x ~ Null_Metabolomics_p$Gender))$coefficients[2,4]
})
fc1 = apply(Null_Metabolomics_e,1,function(x){
mean(x[Null_Metabolomics_p$Gender %in% "Male"])/mean(x[Null_Metabolomics_p$Gender %in% "Female"])
})
p_val_adj1 = p.adjust(p_val1, method = "fdr")
## 2 adjust by body weight
Phenotype_UCDavisSelect = wcmc::read_data("Phenotype_UCDavisSelect.xlsx")
Phenotype_UCDavisSelect_p = Phenotype_UCDavisSelect$p
Phenotype_UCDavisSelect_f = Phenotype_UCDavisSelect$f
Phenotype_UCDavisSelect_e = Phenotype_UCDavisSelect$e_matrix
body_weight_all = Phenotype_UCDavisSelect_e[,Phenotype_UCDavisSelect_p[["phenotype"]] %in% "Body weight"]
names(body_weight_all) = Phenotype_UCDavisSelect_f$label
body_weight = body_weight_all[Null_Metabolomics_p$label]
p_val2 = apply(Null_Metabolomics_e,1,function(x){
summary(lm(x ~ Null_Metabolomics_p$Gender + body_weight))$coefficients[2,4]
})
fc2 = apply(Null_Metabolomics_e,1,function(x){
summary(lm(x ~ Null_Metabolomics_p$Gender + body_weight))$coefficients[2,1]
})
p_val_adj2 = p.adjust(p_val2,"fdr")
## 3 phenotype
Raw_Phenotype_UCDavis = wcmc::read_data("Raw_Phenotype_UCDavis.xlsx")
Raw_Phenotype_UCDavis_p = Raw_Phenotype_UCDavis$p
Raw_Phenotype_UCDavis_f = Raw_Phenotype_UCDavis$f
Raw_Phenotype_UCDavis_e = Raw_Phenotype_UCDavis$e_cat_matrix
Raw_Phenotype_UCDavis_f$label_procedure = sapply(strsplit(Raw_Phenotype_UCDavis_f$label,"___"),function(x){x[1]})
Raw_Phenotype_UCDavis_f$label_phenotype = sapply(strsplit(Raw_Phenotype_UCDavis_f$label,"___"),function(x){x[2]})
rownames(Raw_Phenotype_UCDavis_e) = Raw_Phenotype_UCDavis_f$label
# combine the phenotypes because one phenotype may have multiple procedures.
unique_phenotype = unique(Raw_Phenotype_UCDavis_f$label_phenotype)
for(u in 1:length(unique_phenotype)){
if(sum(Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u])>1){
if(length(table(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],]))>1){
duplicated_value_index = which(apply(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],],2,function(x){
if(length(unique(x)) == 1){
if(!unique(x)=="NA"){
return(TRUE)
}else{
return(FALSE)
}
}else{
return(FALSE)
}
}))
if(length(duplicated_value_index)>0){
print(unique_phenotype[u])
print(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],1:10])
Sys.sleep(20)
}
}
}
}
Raw_Phenotype_UCDavis_e_merge = matrix(NA, nrow = length(unique(Raw_Phenotype_UCDavis_f$label_phenotype)), ncol = ncol(Raw_Phenotype_UCDavis_e))
rownames(Raw_Phenotype_UCDavis_e_merge) = unique(Raw_Phenotype_UCDavis_f$label_phenotype)
i = 1
for(u in 1:length(unique_phenotype)){
if(sum(Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u])>1){
# stop(u)
for(j in 1:ncol(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],])){
the_j_th_col = Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],j]
if(!length(unique(the_j_th_col)) == 1){
Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],][the_j_th_col == "NA",j] = Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],][!the_j_th_col == "NA",j]
}
}
Raw_Phenotype_UCDavis_e_merge[i,] = unique(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],])
i = i + 1
}else{
Raw_Phenotype_UCDavis_e_merge[i,] = Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],]
i = i + 1
}
}
#
# for(i in 1:nrow(Raw_Phenotype_UCDavis_e_merge)){
#
#   if(sum(is.na(as.numeric(Raw_Phenotype_UCDavis_e_merge[i,]))) > nrow(Raw_Phenotype_UCDavis_p)/2){
#     print(i)
#     print(table(Raw_Phenotype_UCDavis_e_merge[i,]))
#     cat("\n")
#     Sys.sleep(2)
#   }
#
# }
#
#
Raw_Phenotype_UCDavis_e_merge[Raw_Phenotype_UCDavis_e_merge == "NA"] = NA
Raw_Phenotype_UCDavis_e_null = Raw_Phenotype_UCDavis_e_merge[,Raw_Phenotype_UCDavis_p$Genotype %in% "(null)"]
Raw_Phenotype_UCDavis_p_null = Raw_Phenotype_UCDavis_p[Raw_Phenotype_UCDavis_p$Genotype %in% "(null)",]
p_val3 = c()
continuous_index = c()
for(i in 1:nrow(Raw_Phenotype_UCDavis_e_merge)){
continuous = sum(is.na(as.numeric(Raw_Phenotype_UCDavis_e_merge[i,!is.na(Raw_Phenotype_UCDavis_e_merge[i,])]))) == 0
if(continuous){
continuous_index[i] = TRUE
p_val3[length(p_val3)+1] = tryCatch(summary(lm(as.numeric(Raw_Phenotype_UCDavis_e_null[i,])~ Raw_Phenotype_UCDavis_p_null$Gender))$coef[2,4],error = function(er){
return(NA)
})
}else{
continuous_index[i] = FALSE
p_val3[length(p_val3)+1] = summary(xtabs(~Raw_Phenotype_UCDavis_e_null[i,] + Raw_Phenotype_UCDavis_p_null$Gender))$p.value
}
}
sum(p_val3[continuous_index]<0.05,na.rm = TRUE)/sum(continuous_index)
p_val3[23]
p_val3[length(p_val3)+1] = tryCatch(
wilcox.test(as.numeric(Raw_Phenotype_UCDavis_e_null[i,])~ Raw_Phenotype_UCDavis_p_null$Gender)$p.value
,error = function(er){
return(NA)
})
wilcox.test(as.numeric(Raw_Phenotype_UCDavis_e_null[i,])~ Raw_Phenotype_UCDavis_p_null$Gender)$p.value
Raw_Phenotype_UCDavis_e_merge[Raw_Phenotype_UCDavis_e_merge == "NA"] = NA
Raw_Phenotype_UCDavis_e_null = Raw_Phenotype_UCDavis_e_merge[,Raw_Phenotype_UCDavis_p$Genotype %in% "(null)"]
Raw_Phenotype_UCDavis_p_null = Raw_Phenotype_UCDavis_p[Raw_Phenotype_UCDavis_p$Genotype %in% "(null)",]
p_val3 = c()
continuous_index = c()
for(i in 1:nrow(Raw_Phenotype_UCDavis_e_merge)){
continuous = sum(is.na(as.numeric(Raw_Phenotype_UCDavis_e_merge[i,!is.na(Raw_Phenotype_UCDavis_e_merge[i,])]))) == 0
if(continuous){
continuous_index[i] = TRUE
# p_val3[length(p_val3)+1] = tryCatch(summary(lm(as.numeric(Raw_Phenotype_UCDavis_e_null[i,])~ Raw_Phenotype_UCDavis_p_null$Gender))$coef[2,4],error = function(er){
#   return(NA)
# })
p_val3[length(p_val3)+1] = tryCatch(
wilcox.test(as.numeric(Raw_Phenotype_UCDavis_e_null[i,])~ Raw_Phenotype_UCDavis_p_null$Gender)$p.value
,error = function(er){
return(NA)
})
}else{
continuous_index[i] = FALSE
p_val3[length(p_val3)+1] = summary(xtabs(~Raw_Phenotype_UCDavis_e_null[i,] + Raw_Phenotype_UCDavis_p_null$Gender))$p.value
}
}
sum(p_val3[continuous_index]<0.05,na.rm = TRUE)/sum(continuous_index)
p_val3[23]
p_val3[23]*2
p_val3[23]
sum(continuous_index)
sum(p_val3[continuous_index]<0.05,na.rm = TRUE)/sum(continuous_index)
