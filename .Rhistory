fake_p = matrix(0, nrow = nrow(cor_female), ncol = ncol(cor_female))
for(i in 1:nrow(different_direction_index)){
fake_p[different_direction_index[i,1],different_direction_index[i,2]] = 1
}
fake_p = fake_p[different_direction_index_row_unique, different_direction_index_col_unique]
corrplot(data[data_row_order,data_col_order], is.corr = FALSE, insig = c("pch"), p.mat = fake_p[data_row_order,data_col_order], pch = 22, pch.col = "black", pch.cex = 2)
label_data = fread("Metabolite Label_KOMP correlation.csv", header = FALSE)
# 6 in null, the correlation phenotype metabolite (correlation male).csv
pacman::p_load(data.table, corrplot)
cor_data_male= fread("6 in null, the correlation phenotype metabolite (correlation male).csv")
cor_data_male = merge(cor_data_male, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_male_label = cor_data_male[["V3"]]
cor_male = data.matrix(cor_data_male[,-c(1, ncol(cor_data_male), ncol(cor_data_male)-1),with=FALSE])
# rownames(cor_male) = colnames(cor_male) = NULL
rownames(cor_male) = cor_data_male_label
cor_p_data_male= fread("6 in null, the correlation phenotype metabolite (correlation p value male).csv")
cor_p_male = data.matrix(cor_p_data_male[,-1,with=FALSE])
# 6 in null, the correlation phenotype metabolite (correlation female).csv
cor_data_female= fread("6 in null, the correlation phenotype metabolite (correlation female).csv")
cor_data_female = merge(cor_data_female, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_female_label = cor_data_female[["V3"]]
cor_female = data.matrix(cor_data_female[,-c(1, ncol(cor_data_female), ncol(cor_data_female)-1),with=FALSE])
# rownames(cor_female) = colnames(cor_female) = NULL
rownames(cor_female) = cor_data_female_label
cor_p_data_female= fread("6 in null, the correlation phenotype metabolite (correlation p value female).csv")
cor_p_female = data.matrix(cor_p_data_female[,-1,with=FALSE])
different_direction_index = which(cor_male * cor_female < 0 & cor_p_female < 0.05 & cor_p_male < 0.05, arr.ind = T)
different_direction_index_row_unique = unique(different_direction_index[,1])
different_direction_index_col_unique = unique(different_direction_index[,2])
p_data = cor_p_male[different_direction_index_row_unique,different_direction_index_col_unique]
corrplot(data[data_row_order,data_col_order], is.corr = FALSE, insig = c("pch", "p-value", "blank", "n", "label_sig"))
fake_p = matrix(0, nrow = nrow(cor_female), ncol = ncol(cor_female))
for(i in 1:nrow(different_direction_index)){
fake_p[different_direction_index[i,1],different_direction_index[i,2]] = 1
}
fake_p = fake_p[different_direction_index_row_unique, different_direction_index_col_unique]
cor_p_male
different_direction_index_row_unique
p_data = cor_p_male[different_direction_index_row_unique,different_direction_index_col_unique]
label_data = fread("Metabolite Label_KOMP correlation.csv", header = FALSE)
# 6 in null, the correlation phenotype metabolite (correlation male).csv
pacman::p_load(data.table, corrplot)
cor_data_male= fread("6 in null, the correlation phenotype metabolite (correlation male).csv")
cor_data_male = merge(cor_data_male, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_male_label = cor_data_male[["V3"]]
cor_male = data.matrix(cor_data_male[,-c(1, ncol(cor_data_male), ncol(cor_data_male)-1),with=FALSE])
# rownames(cor_male) = colnames(cor_male) = NULL
rownames(cor_male) = cor_data_male_label
cor_p_data_male= fread("6 in null, the correlation phenotype metabolite (correlation p value male).csv")
cor_p_male = data.matrix(cor_p_data_male[,-1,with=FALSE])
# 6 in null, the correlation phenotype metabolite (correlation female).csv
cor_data_female= fread("6 in null, the correlation phenotype metabolite (correlation female).csv")
cor_data_female = merge(cor_data_female, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_female_label = cor_data_female[["V3"]]
cor_female = data.matrix(cor_data_female[,-c(1, ncol(cor_data_female), ncol(cor_data_female)-1),with=FALSE])
# rownames(cor_female) = colnames(cor_female) = NULL
rownames(cor_female) = cor_data_female_label
cor_p_data_female= fread("6 in null, the correlation phenotype metabolite (correlation p value female).csv")
cor_p_female = data.matrix(cor_p_data_female[,-1,with=FALSE])
different_direction_index = which(cor_male * cor_female < 0 & cor_p_female < 0.05 & cor_p_male < 0.05, arr.ind = T)
different_direction_index_row_unique = unique(different_direction_index[,1])
different_direction_index_col_unique = unique(different_direction_index[,2])
p_data = cor_p_male[different_direction_index_row_unique,different_direction_index_col_unique]
corrplot(data[data_row_order,data_col_order], is.corr = FALSE, insig = c("pch", "p-value", "blank", "n", "label_sig"))
label_data = fread("Metabolite Label_KOMP correlation.csv", header = FALSE)
# 6 in null, the correlation phenotype metabolite (correlation male).csv
pacman::p_load(data.table, corrplot)
cor_data_male= fread("6 in null, the correlation phenotype metabolite (correlation male).csv")
cor_data_male = merge(cor_data_male, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_male_label = cor_data_male[["V3"]]
cor_male = data.matrix(cor_data_male[,-c(1, ncol(cor_data_male), ncol(cor_data_male)-1),with=FALSE])
# rownames(cor_male) = colnames(cor_male) = NULL
rownames(cor_male) = cor_data_male_label
cor_p_data_male= fread("6 in null, the correlation phenotype metabolite (correlation p value male).csv")
cor_p_male = data.matrix(cor_p_data_male[,-1,with=FALSE])
# 6 in null, the correlation phenotype metabolite (correlation female).csv
cor_data_female= fread("6 in null, the correlation phenotype metabolite (correlation female).csv")
cor_data_female = merge(cor_data_female, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_female_label = cor_data_female[["V3"]]
cor_female = data.matrix(cor_data_female[,-c(1, ncol(cor_data_female), ncol(cor_data_female)-1),with=FALSE])
# rownames(cor_female) = colnames(cor_female) = NULL
rownames(cor_female) = cor_data_female_label
cor_p_data_female= fread("6 in null, the correlation phenotype metabolite (correlation p value female).csv")
cor_p_female = data.matrix(cor_p_data_female[,-1,with=FALSE])
different_direction_index = which(cor_male * cor_female < 0 & cor_p_female < 0.05 & cor_p_male < 0.05, arr.ind = T)
different_direction_index_row_unique = unique(different_direction_index[,1])
different_direction_index_col_unique = unique(different_direction_index[,2])
p_data = cor_p_male[different_direction_index_row_unique,different_direction_index_col_unique]
corrplot(data[data_row_order,data_col_order], is.corr = FALSE, insig = c("pch", "p-value", "blank", "n", "label_sig"))
label_data = fread("Metabolite Label_KOMP correlation.csv", header = FALSE)
# 6 in null, the correlation phenotype metabolite (correlation male).csv
pacman::p_load(data.table, corrplot)
cor_data_male= fread("6 in null, the correlation phenotype metabolite (correlation male).csv")
cor_data_male = merge(cor_data_male, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_male_label = cor_data_male[["V3"]]
cor_male = data.matrix(cor_data_male[,-c(1, ncol(cor_data_male), ncol(cor_data_male)-1),with=FALSE])
# rownames(cor_male) = colnames(cor_male) = NULL
rownames(cor_male) = cor_data_male_label
cor_p_data_male= fread("6 in null, the correlation phenotype metabolite (correlation p value male).csv")
cor_p_male = data.matrix(cor_p_data_male[,-1,with=FALSE])
# 6 in null, the correlation phenotype metabolite (correlation female).csv
cor_data_female= fread("6 in null, the correlation phenotype metabolite (correlation female).csv")
cor_data_female = merge(cor_data_female, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_female_label = cor_data_female[["V3"]]
cor_female = data.matrix(cor_data_female[,-c(1, ncol(cor_data_female), ncol(cor_data_female)-1),with=FALSE])
# rownames(cor_female) = colnames(cor_female) = NULL
rownames(cor_female) = cor_data_female_label
cor_p_data_female= fread("6 in null, the correlation phenotype metabolite (correlation p value female).csv")
cor_p_female = data.matrix(cor_p_data_female[,-1,with=FALSE])
different_direction_index = which(cor_male * cor_female < 0 & cor_p_female < 0.05 & cor_p_male < 0.05, arr.ind = T)
different_direction_index_row_unique = unique(different_direction_index[,1])
different_direction_index_col_unique = unique(different_direction_index[,2])
p_data = cor_p_male[different_direction_index_row_unique,different_direction_index_col_unique]
par(mfrow=c(1,1))
data = cor_female[different_direction_index_row_unique,different_direction_index_col_unique] - cor_male[different_direction_index_row_unique,different_direction_index_col_unique]
data_row_order =  hclust(dist(data))$order
data_col_order =  hclust(dist(t(data)))$order
corrplot(data[data_row_order,data_col_order], is.corr = FALSE, insig = c("pch", "p-value", "blank", "n", "label_sig"))
label_data = fread("Metabolite Label_KOMP correlation.csv", header = FALSE)
# 6 in null, the correlation phenotype metabolite (correlation male).csv
pacman::p_load(data.table, corrplot)
cor_data_male= fread("6 in null, the correlation phenotype metabolite (correlation male).csv")
cor_data_male = merge(cor_data_male, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_male_label = cor_data_male[["V3"]]
cor_male = data.matrix(cor_data_male[,-c(1, ncol(cor_data_male), ncol(cor_data_male)-1),with=FALSE])
# rownames(cor_male) = colnames(cor_male) = NULL
rownames(cor_male) = cor_data_male_label
cor_p_data_male= fread("6 in null, the correlation phenotype metabolite (correlation p value male).csv")
cor_p_male = data.matrix(cor_p_data_male[,-1,with=FALSE])
# 6 in null, the correlation phenotype metabolite (correlation female).csv
cor_data_female= fread("6 in null, the correlation phenotype metabolite (correlation female).csv")
cor_data_female = merge(cor_data_female, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_female_label = cor_data_female[["V3"]]
cor_female = data.matrix(cor_data_female[,-c(1, ncol(cor_data_female), ncol(cor_data_female)-1),with=FALSE])
# rownames(cor_female) = colnames(cor_female) = NULL
rownames(cor_female) = cor_data_female_label
cor_p_data_female= fread("6 in null, the correlation phenotype metabolite (correlation p value female).csv")
cor_p_female = data.matrix(cor_p_data_female[,-1,with=FALSE])
different_direction_index = which(cor_male * cor_female < 0 & cor_p_female < 0.05 & cor_p_male < 0.05, arr.ind = T)
different_direction_index_row_unique = unique(different_direction_index[,1])
different_direction_index_col_unique = unique(different_direction_index[,2])
p_data = cor_p_male[different_direction_index_row_unique,different_direction_index_col_unique]
par(mfrow=c(1,1))
data = cor_female[different_direction_index_row_unique,different_direction_index_col_unique] - cor_male[different_direction_index_row_unique,different_direction_index_col_unique]
data_row_order =  hclust(dist(data))$order
data_col_order =  hclust(dist(t(data)))$order
fake_p = matrix(0, nrow = nrow(cor_female), ncol = ncol(cor_female))
for(i in 1:nrow(different_direction_index)){
fake_p[different_direction_index[i,1],different_direction_index[i,2]] = 1
}
fake_p = fake_p[different_direction_index_row_unique, different_direction_index_col_unique]
label_data = fread("Metabolite Label_KOMP correlation.csv", header = FALSE)
# 6 in null, the correlation phenotype metabolite (correlation male).csv
pacman::p_load(data.table, corrplot)
cor_data_male= fread("6 in null, the correlation phenotype metabolite (correlation male).csv")
cor_data_male = merge(cor_data_male, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_male_label = cor_data_male[["V3"]]
cor_male = data.matrix(cor_data_male[,-c(1, ncol(cor_data_male), ncol(cor_data_male)-1),with=FALSE])
# rownames(cor_male) = colnames(cor_male) = NULL
rownames(cor_male) = cor_data_male_label
cor_p_data_male= fread("6 in null, the correlation phenotype metabolite (correlation p value male).csv")
cor_p_male = data.matrix(cor_p_data_male[,-1,with=FALSE])
# 6 in null, the correlation phenotype metabolite (correlation female).csv
cor_data_female= fread("6 in null, the correlation phenotype metabolite (correlation female).csv")
cor_data_female = merge(cor_data_female, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_female_label = cor_data_female[["V3"]]
cor_female = data.matrix(cor_data_female[,-c(1, ncol(cor_data_female), ncol(cor_data_female)-1),with=FALSE])
# rownames(cor_female) = colnames(cor_female) = NULL
rownames(cor_female) = cor_data_female_label
cor_p_data_female= fread("6 in null, the correlation phenotype metabolite (correlation p value female).csv")
cor_p_female = data.matrix(cor_p_data_female[,-1,with=FALSE])
different_direction_index = which(cor_male * cor_female < 0 & cor_p_female < 0.05 & cor_p_male < 0.05, arr.ind = T)
different_direction_index_row_unique = unique(different_direction_index[,1])
different_direction_index_col_unique = unique(different_direction_index[,2])
p_data = cor_p_male[different_direction_index_row_unique,different_direction_index_col_unique]
par(mfrow=c(1,1))
data = cor_female[different_direction_index_row_unique,different_direction_index_col_unique] - cor_male[different_direction_index_row_unique,different_direction_index_col_unique]
data_row_order =  hclust(dist(data))$order
data_col_order =  hclust(dist(t(data)))$order
fake_p = matrix(0, nrow = nrow(cor_female), ncol = ncol(cor_female))
for(i in 1:nrow(different_direction_index)){
fake_p[different_direction_index[i,1],different_direction_index[i,2]] = 1
}
fake_p = fake_p[different_direction_index_row_unique, different_direction_index_col_unique]
par(mfrow=c(1,1))
corrplot(cor_male[different_direction_index_row_unique,different_direction_index_col_unique], p.mat = fake_p[data_row_order,data_col_order], method="circle", insig = "blank")
corrplot(cor_female[different_direction_index_row_unique,different_direction_index_col_unique], , p.mat = fake_p[data_row_order,data_col_order], method="circle", insig = "blank")
par(mfrow=c(1,1))
corrplot(cor_male[different_direction_index_row_unique,different_direction_index_col_unique], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 2)
corrplot(cor_female[different_direction_index_row_unique,different_direction_index_col_unique], , p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 2)
label_data = fread("Metabolite Label_KOMP correlation.csv", header = FALSE)
# 6 in null, the correlation phenotype metabolite (correlation male).csv
pacman::p_load(data.table, corrplot)
cor_data_male= fread("6 in null, the correlation phenotype metabolite (correlation male).csv")
cor_data_male = merge(cor_data_male, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_male_label = cor_data_male[["V3"]]
cor_male = data.matrix(cor_data_male[,-c(1, ncol(cor_data_male), ncol(cor_data_male)-1),with=FALSE])
# rownames(cor_male) = colnames(cor_male) = NULL
rownames(cor_male) = cor_data_male_label
cor_p_data_male= fread("6 in null, the correlation phenotype metabolite (correlation p value male).csv")
cor_p_male = data.matrix(cor_p_data_male[,-1,with=FALSE])
# 6 in null, the correlation phenotype metabolite (correlation female).csv
cor_data_female= fread("6 in null, the correlation phenotype metabolite (correlation female).csv")
cor_data_female = merge(cor_data_female, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_female_label = cor_data_female[["V3"]]
cor_female = data.matrix(cor_data_female[,-c(1, ncol(cor_data_female), ncol(cor_data_female)-1),with=FALSE])
# rownames(cor_female) = colnames(cor_female) = NULL
rownames(cor_female) = cor_data_female_label
cor_p_data_female= fread("6 in null, the correlation phenotype metabolite (correlation p value female).csv")
cor_p_female = data.matrix(cor_p_data_female[,-1,with=FALSE])
different_direction_index = which(cor_male * cor_female < 0 & cor_p_female < 0.05 & cor_p_male < 0.05, arr.ind = T)
different_direction_index_row_unique = unique(different_direction_index[,1])
different_direction_index_col_unique = unique(different_direction_index[,2])
p_data = cor_p_male[different_direction_index_row_unique,different_direction_index_col_unique]
par(mfrow=c(1,1))
data = cor_female[different_direction_index_row_unique,different_direction_index_col_unique] - cor_male[different_direction_index_row_unique,different_direction_index_col_unique]
data_row_order =  hclust(dist(data))$order
data_col_order =  hclust(dist(t(data)))$order
fake_p = matrix(0, nrow = nrow(cor_female), ncol = ncol(cor_female))
for(i in 1:nrow(different_direction_index)){
fake_p[different_direction_index[i,1],different_direction_index[i,2]] = 1
}
fake_p = fake_p[different_direction_index_row_unique, different_direction_index_col_unique]
corrplot(data[data_row_order,data_col_order], is.corr = FALSE, insig = c("pch"), p.mat = fake_p[data_row_order,data_col_order], pch = 22, pch.col = "black", pch.cex = 2)
dim(data)
data
dim(data)
dim(cor_male)
dim(cor_male[different_direction_index_row_unique,different_direction_index_col_unique])
par(mfrow=c(1,1))
corrplot(cor_male[different_direction_index_row_unique,different_direction_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 2)
corrplot(cor_female[different_direction_index_row_unique,different_direction_index_col_unique][data_row_order,data_col_order], , p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 2)
corrplot(data[data_row_order,data_col_order], is.corr = FALSE, insig = c("pch"), p.mat = fake_p[data_row_order,data_col_order], pch = 22, pch.col = "black", pch.cex = 2)
corrplot(cor_male[different_direction_index_row_unique,different_direction_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 2)
corrplot(cor_female[different_direction_index_row_unique,different_direction_index_col_unique][data_row_order,data_col_order], , p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 2)
################## DIFFERENT SIZE ##################
different_size_index = which(cor_male * cor_female > 0 & cor_p_female < 0.05 & cor_p_male < 0.05, arr.ind = T)
different_size_index_row_unique = unique(different_size_index[,1])
different_size_index_col_unique = unique(different_size_index[,2])
label_data = fread("Metabolite Label_KOMP correlation.csv", header = FALSE)
# 6 in null, the correlation phenotype metabolite (correlation male).csv
pacman::p_load(data.table, corrplot)
cor_data_male= fread("6 in null, the correlation phenotype metabolite (correlation male).csv")
cor_data_male = merge(cor_data_male, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_male_label = cor_data_male[["V3"]]
cor_male = data.matrix(cor_data_male[,-c(1, ncol(cor_data_male), ncol(cor_data_male)-1),with=FALSE])
# rownames(cor_male) = colnames(cor_male) = NULL
rownames(cor_male) = cor_data_male_label
cor_p_data_male= fread("6 in null, the correlation phenotype metabolite (correlation p value male).csv")
cor_p_male = data.matrix(cor_p_data_male[,-1,with=FALSE])
# 6 in null, the correlation phenotype metabolite (correlation female).csv
cor_data_female= fread("6 in null, the correlation phenotype metabolite (correlation female).csv")
cor_data_female = merge(cor_data_female, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_female_label = cor_data_female[["V3"]]
cor_female = data.matrix(cor_data_female[,-c(1, ncol(cor_data_female), ncol(cor_data_female)-1),with=FALSE])
# rownames(cor_female) = colnames(cor_female) = NULL
rownames(cor_female) = cor_data_female_label
cor_p_data_female= fread("6 in null, the correlation phenotype metabolite (correlation p value female).csv")
cor_p_female = data.matrix(cor_p_data_female[,-1,with=FALSE])
different_size_index = which(cor_male * cor_female > 0 & cor_p_female < 0.05 & cor_p_male < 0.05, arr.ind = T)
different_size_index_row_unique = unique(different_size_index[,1])
different_size_index_col_unique = unique(different_size_index[,2])
p_data = cor_p_male[different_size_index_row_unique,different_size_index_col_unique]
par(mfrow=c(1,1))
data = cor_female[different_size_index_row_unique,different_size_index_col_unique] - cor_male[different_size_index_row_unique,different_size_index_col_unique]
data_row_order =  hclust(dist(data))$order
data_col_order =  hclust(dist(t(data)))$order
fake_p = matrix(0, nrow = nrow(cor_female), ncol = ncol(cor_female))
for(i in 1:nrow(different_size_index)){
fake_p[different_size_index[i,1],different_size_index[i,2]] = 1
}
fake_p = fake_p[different_size_index_row_unique, different_size_index_col_unique]
corrplot(data[data_row_order,data_col_order], is.corr = FALSE, insig = c("pch"), p.mat = fake_p[data_row_order,data_col_order], pch = 22, pch.col = "black", pch.cex = 2)
par(mfrow=c(1,1))
corrplot(cor_male[different_direction_index_row_unique,different_direction_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 2)
corrplot(cor_female[different_direction_index_row_unique,different_direction_index_col_unique][data_row_order,data_col_order], , p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 2)
################## DIFFERENT SIZE ##################
different_size_index = which(cor_male * cor_female > 0 & cor_p_female < 0.05 & cor_p_male < 0.05, arr.ind = T)
different_size_index_row_unique = unique(different_size_index[,1])
different_size_index_col_unique = unique(different_size_index[,2])
p_data = cor_p_male[different_size_index_row_unique,different_size_index_col_unique]
par(mfrow=c(1,1))
data = cor_female[different_size_index_row_unique,different_size_index_col_unique] - cor_male[different_size_index_row_unique,different_size_index_col_unique]
data_row_order =  hclust(dist(data))$order
data_col_order =  hclust(dist(t(data)))$order
fake_p = matrix(0, nrow = nrow(cor_female), ncol = ncol(cor_female))
for(i in 1:nrow(different_size_index)){
fake_p[different_size_index[i,1],different_size_index[i,2]] = 1
}
fake_p = fake_p[different_size_index_row_unique, different_size_index_col_unique]
corrplot(data[data_row_order,data_col_order], is.corr = FALSE, insig = c("pch"), p.mat = fake_p[data_row_order,data_col_order], pch = 22, pch.col = "black", pch.cex = 2)
par(mfrow=c(1,1))
corrplot(cor_male[different_size_index_row_unique,different_size_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 2)
corrplot(cor_female[different_size_index_row_unique,different_size_index_col_unique][data_row_order,data_col_order], , p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 2)
label_data = fread("Metabolite Label_KOMP correlation.csv", header = FALSE)
# 6 in null, the correlation phenotype metabolite (correlation male).csv
pacman::p_load(data.table, corrplot)
cor_data_male= fread("6 in null, the correlation phenotype metabolite (correlation male).csv")
cor_data_male = merge(cor_data_male, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_male_label = cor_data_male[["V3"]]
cor_male = data.matrix(cor_data_male[,-c(1, ncol(cor_data_male), ncol(cor_data_male)-1),with=FALSE])
# rownames(cor_male) = colnames(cor_male) = NULL
rownames(cor_male) = cor_data_male_label
cor_p_data_male= fread("6 in null, the correlation phenotype metabolite (correlation p value male).csv")
cor_p_male = data.matrix(cor_p_data_male[,-1,with=FALSE])
# 6 in null, the correlation phenotype metabolite (correlation female).csv
cor_data_female= fread("6 in null, the correlation phenotype metabolite (correlation female).csv")
cor_data_female = merge(cor_data_female, label_data, by.x = "V1", by.y = "V2", sort = FALSE)
cor_data_female_label = cor_data_female[["V3"]]
cor_female = data.matrix(cor_data_female[,-c(1, ncol(cor_data_female), ncol(cor_data_female)-1),with=FALSE])
# rownames(cor_female) = colnames(cor_female) = NULL
rownames(cor_female) = cor_data_female_label
cor_p_data_female= fread("6 in null, the correlation phenotype metabolite (correlation p value female).csv")
cor_p_female = data.matrix(cor_p_data_female[,-1,with=FALSE])
################## DIFFERENT SIZE ##################
different_size_index = which(cor_male * cor_female > 0 & cor_p_female < 0.05 & cor_p_male < 0.05, arr.ind = T)
different_size_index_row_unique = unique(different_size_index[,1])
different_size_index_col_unique = unique(different_size_index[,2])
p_data = cor_p_male[different_size_index_row_unique,different_size_index_col_unique]
par(mfrow=c(1,1))
data = cor_female[different_size_index_row_unique,different_size_index_col_unique] - cor_male[different_size_index_row_unique,different_size_index_col_unique]
data_row_order =  hclust(dist(data))$order
data_col_order =  hclust(dist(t(data)))$order
fake_p = matrix(0, nrow = nrow(cor_female), ncol = ncol(cor_female))
for(i in 1:nrow(different_size_index)){
fake_p[different_size_index[i,1],different_size_index[i,2]] = 1
}
fake_p = fake_p[different_size_index_row_unique, different_size_index_col_unique]
corrplot(data[data_row_order,data_col_order], is.corr = FALSE, insig = c("pch"), p.mat = fake_p[data_row_order,data_col_order], pch = 22, pch.col = "black", pch.cex = 2)
par(mfrow=c(1,1))
corrplot(cor_male[different_size_index_row_unique,different_size_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 2)
corrplot(cor_female[different_size_index_row_unique,different_size_index_col_unique][data_row_order,data_col_order], , p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 2)
nrow(different_size_index)
par(mfrow=c(1,1))
corrplot(cor_male[different_size_index_row_unique,different_size_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 2)
corrplot(cor_female[different_size_index_row_unique,different_size_index_col_unique][data_row_order,data_col_order], , p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 2)
par(mfrow=c(1,1))
corrplot(cor_male[different_size_index_row_unique,different_size_index_col_unique][data_row_order,data_col_order][1:100,], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 2)
corrplot(cor_female[different_size_index_row_unique,different_size_index_col_unique][data_row_order,data_col_order][1:100,], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 2)
par(mfrow=c(1,1))
corrplot(cor_male[different_size_index_row_unique,different_size_index_col_unique][data_row_order,data_col_order][1:100,], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 1)
corrplot(cor_female[different_size_index_row_unique,different_size_index_col_unique][data_row_order,data_col_order][1:100,], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 1)
par(mfrow=c(1,1))
corrplot(cor_male[different_size_index_row_unique,different_size_index_col_unique][data_row_order,data_col_order][1:100,], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 1.5)
corrplot(cor_female[different_size_index_row_unique,different_size_index_col_unique][data_row_order,data_col_order][1:100,], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 1.5)
corrplot(cor_male[different_size_index_row_unique,different_size_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 0.05)
par(mfrow=c(1,1))
corrplot(cor_male[different_size_index_row_unique,different_size_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 1)
corrplot(cor_male[different_size_index_row_unique,different_size_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 5)
corrplot(cor_female[different_size_index_row_unique,different_size_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 5)
################## SIGNIFICANT IN ONE GENDER ##################
one_gender_female_index = which(cor_p_female < 0.05 & cor_p_male > 0.05, arr.ind = T)
one_gender_female_index_row_unique = unique(one_gender_female_index[,1])
one_gender_female_index_col_unique = unique(one_gender_female_index[,2])
p_data = cor_p_male[one_gender_female_index_row_unique,one_gender_female_index_col_unique]
par(mfrow=c(1,1))
data = cor_female[one_gender_female_index_row_unique,one_gender_female_index_col_unique] - cor_male[one_gender_female_index_row_unique,one_gender_female_index_col_unique]
data_row_order =  hclust(dist(data))$order
data_col_order =  hclust(dist(t(data)))$order
fake_p = matrix(0, nrow = nrow(cor_female), ncol = ncol(cor_female))
for(i in 1:nrow(one_gender_female_index)){
fake_p[one_gender_female_index[i,1],one_gender_female_index[i,2]] = 1
}
fake_p = fake_p[one_gender_female_index_row_unique, one_gender_female_index_col_unique]
corrplot(data[data_row_order,data_col_order], is.corr = FALSE, insig = c("pch"), p.mat = fake_p[data_row_order,data_col_order], pch = 22, pch.col = "black", pch.cex = 2)
par(mfrow=c(1,1))
corrplot(cor_male[one_gender_female_index_row_unique,one_gender_female_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 5)
corrplot(cor_female[one_gender_female_index_row_unique,one_gender_female_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 5)
Null_Metabolomics = wcmc::read_data("Null_Metabolomics.xlsx")
Null_Metabolomics_p = Null_Metabolomics$p
Null_Metabolomics_f = Null_Metabolomics$f
Null_Metabolomics_e = Null_Metabolomics$e_matrix
## 1 wild - sex
### deal with missing value.
#### filter missing value > 80%
num_missing_male = apply(Null_Metabolomics_e,1,function(x){
sum(is.na(x[Null_Metabolomics_p$Gender %in% "Male"]))
})
num_missing_female = apply(Null_Metabolomics_e,1,function(x){
sum(is.na(x[Null_Metabolomics_p$Gender %in% "Female"]))
})
names(num_missing_male) = names(num_missing_female) = Null_Metabolomics_f$label
missing_index = ((num_missing_male/sum(Null_Metabolomics_p$Gender %in% "Male")) > 0.8)|((num_missing_female/sum(Null_Metabolomics_p$Gender %in% "Female")) > 0.8)
Null_Metabolomics_e = Null_Metabolomics_e[!missing_index,]
Null_Metabolomics_f = Null_Metabolomics_f[!missing_index,]
#### filter missing value > 80%
for(i in 1:nrow(Null_Metabolomics_e)){
Null_Metabolomics_e[i,is.na(Null_Metabolomics_e[i,])] = 0.5 * min(Null_Metabolomics_e[i,], na.rm = TRUE)
}
rownames(Null_Metabolomics_e) = Null_Metabolomics_f$label
## statistics
p_val1 = apply(Null_Metabolomics_e,1,function(x){
summary(lm(x ~ Null_Metabolomics_p$Gender))$coefficients[2,4]
})
fc1 = apply(Null_Metabolomics_e,1,function(x){
mean(x[Null_Metabolomics_p$Gender %in% "Male"])/mean(x[Null_Metabolomics_p$Gender %in% "Female"])
})
p_val_adj1 = p.adjust(p_val1, method = "fdr")
sum(p_val1<0.05)/length(p_val1)
fwrite(data.table(label = Null_Metabolomics_f$label, p_value = p_val1, fold_change = fc1, adjusted_p_value = p_val_adj1),"1 wild - sex.csv")
## 2 adjust by body weight
Phenotype_UCDavisSelect = wcmc::read_data("Phenotype_UCDavisSelect.xlsx")
Phenotype_UCDavisSelect_p = Phenotype_UCDavisSelect$p
Phenotype_UCDavisSelect_f = Phenotype_UCDavisSelect$f
Phenotype_UCDavisSelect_e = Phenotype_UCDavisSelect$e_matrix
body_weight_all = Phenotype_UCDavisSelect_e[,Phenotype_UCDavisSelect_p[["phenotype"]] %in% "Body weight"]
names(body_weight_all) = Phenotype_UCDavisSelect_f$label
body_weight = body_weight_all[Null_Metabolomics_p$label]
p_val2 = apply(Null_Metabolomics_e,1,function(x){
summary(lm(x ~ Null_Metabolomics_p$Gender + body_weight))$coefficients[2,4]
})
fc2 = apply(Null_Metabolomics_e,1,function(x){
summary(lm(x ~ Null_Metabolomics_p$Gender + body_weight))$coefficients[2,1]
})
p_val_adj2 = p.adjust(p_val2,"fdr")
sum(p_val2<0.05)/length(p_val2)
fwrite(data.table(label = rownames(Null_Metabolomics_e), p_value = p_val2, fold_change = fc2, adjusted_p_value = p_val_adj2),"2 adjust by body weight.csv")
## 3 phenotype -  sex
Raw_Phenotype_UCDavis = wcmc::read_data("Raw_Phenotype_UCDavis.xlsx")
Raw_Phenotype_UCDavis_p = Raw_Phenotype_UCDavis$p
Raw_Phenotype_UCDavis_f = Raw_Phenotype_UCDavis$f
Raw_Phenotype_UCDavis_e = Raw_Phenotype_UCDavis$e_cat_matrix
Raw_Phenotype_UCDavis_f$label_procedure = sapply(strsplit(Raw_Phenotype_UCDavis_f$label,"___"),function(x){x[1]})
Raw_Phenotype_UCDavis_f$label_phenotype = sapply(strsplit(Raw_Phenotype_UCDavis_f$label,"___"),function(x){x[2]})
rownames(Raw_Phenotype_UCDavis_e) = Raw_Phenotype_UCDavis_f$label
# combine the phenotypes because one phenotype may have multiple procedures.
unique_phenotype = unique(Raw_Phenotype_UCDavis_f$label_phenotype)
for(u in 1:length(unique_phenotype)){
if(sum(Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u])>1){
if(length(table(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],]))>1){
duplicated_value_index = which(apply(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],],2,function(x){
if(length(unique(x)) == 1){
if(!unique(x)=="NA"){
return(TRUE)
}else{
return(FALSE)
}
}else{
return(FALSE)
}
}))
if(length(duplicated_value_index)>0){
print(unique_phenotype[u])
print(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],1:10])
Sys.sleep(20)
}
}
}
}
Raw_Phenotype_UCDavis_e_merge = matrix(NA, nrow = length(unique(Raw_Phenotype_UCDavis_f$label_phenotype)), ncol = ncol(Raw_Phenotype_UCDavis_e))
rownames(Raw_Phenotype_UCDavis_e_merge) = unique(Raw_Phenotype_UCDavis_f$label_phenotype)
i = 1
for(u in 1:length(unique_phenotype)){
if(sum(Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u])>1){
# stop(u)
for(j in 1:ncol(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],])){
the_j_th_col = Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],j]
if(!length(unique(the_j_th_col)) == 1){
Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],][the_j_th_col == "NA",j] = Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],][!the_j_th_col == "NA",j]
}
}
Raw_Phenotype_UCDavis_e_merge[i,] = unique(Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],])
i = i + 1
}else{
Raw_Phenotype_UCDavis_e_merge[i,] = Raw_Phenotype_UCDavis_e[Raw_Phenotype_UCDavis_f$label_phenotype %in% unique_phenotype[u],]
i = i + 1
}
}
#
# for(i in 1:nrow(Raw_Phenotype_UCDavis_e_merge)){
#
#   if(sum(is.na(as.numeric(Raw_Phenotype_UCDavis_e_merge[i,]))) > nrow(Raw_Phenotype_UCDavis_p)/2){
#     print(i)
#     print(table(Raw_Phenotype_UCDavis_e_merge[i,]))
#     cat("\n")
#     Sys.sleep(2)
#   }
#
# }
#
#
Raw_Phenotype_UCDavis_e_merge[Raw_Phenotype_UCDavis_e_merge == "NA"] = NA
Raw_Phenotype_UCDavis_e_null = Raw_Phenotype_UCDavis_e_merge[,Raw_Phenotype_UCDavis_p$Genotype %in% "(null)"]
Raw_Phenotype_UCDavis_p_null = Raw_Phenotype_UCDavis_p[Raw_Phenotype_UCDavis_p$Genotype %in% "(null)",]
factor(Raw_Phenotype_UCDavis_p_null$Gender)
?corrplot
corrplot(cor_female[one_gender_female_index_row_unique,one_gender_female_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 5, tl.cex = 5)
par(mfrow=c(1,1))
corrplot(cor_female[one_gender_female_index_row_unique,one_gender_female_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 5, tl.cex = 2)
par(mfrow=c(1,1))
corrplot(cor_female[one_gender_female_index_row_unique,one_gender_female_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "black", pch.cex = 8, tl.cex = 2)
corrplot(cor_female[one_gender_female_index_row_unique,one_gender_female_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "red", pch.cex = 5, tl.cex = 2)
par(mfrow=c(1,1))
corrplot(cor_female[one_gender_female_index_row_unique,one_gender_female_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "red", pch.cex = 5, tl.cex = 2)
corrplot(cor_female[one_gender_female_index_row_unique,one_gender_female_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "red", pch.cex = 5, tl.cex = 2)
################## SIGNIFICANT IN ONE GENDER MALE ##################
one_gender_male_index = which(cor_p_female > 0.05 & cor_p_male < 0.05, arr.ind = T)
one_gender_male_index_row_unique = unique(one_gender_male_index[,1])
one_gender_male_index_col_unique = unique(one_gender_male_index[,2])
p_data = cor_p_male[one_gender_male_index_row_unique,one_gender_male_index_col_unique]
par(mfrow=c(1,1))
data = cor_female[one_gender_male_index_row_unique,one_gender_male_index_col_unique] - cor_male[one_gender_male_index_row_unique,one_gender_male_index_col_unique]
data_row_order =  hclust(dist(data))$order
data_col_order =  hclust(dist(t(data)))$order
fake_p = matrix(0, nrow = nrow(cor_female), ncol = ncol(cor_female))
for(i in 1:nrow(one_gender_male_index)){
fake_p[one_gender_male_index[i,1],one_gender_male_index[i,2]] = 1
}
fake_p = fake_p[one_gender_male_index_row_unique, one_gender_male_index_col_unique]
corrplot(data[data_row_order,data_col_order], is.corr = FALSE, insig = c("pch"), p.mat = fake_p[data_row_order,data_col_order], pch = 22, pch.col = "black", pch.cex = 2)
par(mfrow=c(1,1))
corrplot(cor_male[one_gender_male_index_row_unique,one_gender_male_index_col_unique][data_row_order,data_col_order], p.mat = fake_p[data_row_order,data_col_order], method="circle", pch = 22, pch.col = "red", pch.cex = 5, tl.cex = 2)
